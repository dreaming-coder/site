# 图 - 关键路径

## 1. AOE 网

在带权有向图中，以顶点表示事件，以有向边表示活动，以边上的权值表示完成该活动的开销(如完成活动所需的时间)，称之为用边表示活动的网络，简称 AOE 网。AOE 网和 AOV 网都是有向无环图，不同之处在于它们的边和顶点所代表的含义是不同的，AOE 网中的边有权值；而 AOV 网中的边无权值，仅表示顶点之间的前后关系。

AOE 网具有以下两个性质：

① 只有在某顶点所代表的事件发生后，从该顶点出发的各有向边所代表的活动才能开始；

② 只有在进入某顶点的各有向边所代表的活动都已结束时，该顶点所代表的事件才能发生。

在 AOE 网中仅有一个入度为 $0$ 的顶点，称为开始顶点(源点)，它表示整个工程的开始；网中也仅存在一一个出度为 $0$ 的顶点，称为结束顶点(汇点)， 它表示整个工程的结束。

在 AOE 网中，有些活动是可以并行进行的。从源点到汇点的有向路径可能有多条，并且这些路径长度可能不同。完成不同路径上的活动所需的时间虽然不同，但是只有所有路径上的活动都已完成，整个工程才能算结束。因此，从源点到汇点的所有路径中，具有最大路径长度的路径称为关键路径，而把关键路径上的活动称为关键活动。

完成整个工程的最短时间就是关键路径的长度，即关键路径上各活动花费开销的总和。这是因为关键活动影响了整个工程的时间，即若关键活动不能按时完成，则整个工程的完成时间就会延长。因此，只要找到了关键活动，就找到了关键路径，也就可以得出最短完成时间。

## 2. 依赖关系

- 事件最早开始时间（$ES$）
- 事件最早结束时间（$EF$）
- 事件最迟开始时间（$LS$）
- 事件最迟结束时间（$LF$）
- 自由时差（$FF$）：指一项工作在不影响其**紧后工作**最早开始时间的条件下，本工作可以利用的机动时间。计算方式是该工作的所有紧后工作的最早开始时间的最小值，减去该工作的最早结束时间。
- 总时差（$TF$）：指一项工作在不影响**总工期**的前提下所具有的机动时间。用工作的最迟开始时间 $LS{i-j}$ 与最早开始时间 $ES{i-j}$ 之差表示或最迟完成时间与最早完成时间之差。**自由时差小于或等于总时差**。
- 持续时间（$D$)：也就是边的权重值

这几个参数的一般计算布局如图所示：

![](/imgs/algorithm/data-structure/graph-aoe-1.png)

## 3. 算法步骤

1. 从源点出发，让从源点出发的边代表的事件最早开始时间为 $0$，拓扑排序有序求其余顶点的最早发生时间（$ES$）和最早结束时间（$EF$）
2. 从汇点出发，让以汇点结束的边代表的事件最迟结束时间等于最早结束时间，逆拓扑排序求其余顶点的最迟结束时间（$LF$）和最迟开始时间（$LS$）
3. 总时差 $TF$ 为 $0$ 的路径就是关键路径

## 4. 算法实例

![](/imgs/algorithm/data-structure/graph-aoe-2.png)

1. 计算 $ES$、$EF$

![](/imgs/algorithm/data-structure/graph-aoe-3.png)

2. 计算 $LF$、$LS$

![](/imgs/algorithm/data-structure/graph-aoe-4.png)

3. 计算 $TF$、$FF$

![](/imgs/algorithm/data-structure/graph-aoe-5.png)

4. $TF$ 为 $0$ 的路径即为关键路径

![](/imgs/algorithm/data-structure/graph-aoe-6.png)

